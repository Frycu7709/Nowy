<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gra Snake</title>
  <style>
    body {
      background-color: #333;
      color: #fff;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }
    h1 {
      margin-top: 20px;
      margin-bottom: 10px;
    }
    canvas {
      background-color: #000;
      display: block;
      margin: 20px auto;
      border: 5px solid #fff;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      width: 200px;
      justify-content: center;
      margin-bottom: 20px;
    }
    .controls button {
      width: 60px;
      height: 60px;
      margin: 5px;
      font-size: 24px;
      border: none;
      border-radius: 5px;
      background-color: #555;
      color: #fff;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .controls button:hover {
      background-color: #777;
    }
    .controls button:active {
      background-color: #999;
    }
    #message {
      font-size: 18px;
      color: red;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>Gra Snake</h1>
  <canvas id="gameCanvas" width="400" height="400"></canvas>
  <div class="controls">
    <button id="btn-up">↑</button>
    <button id="btn-left">←</button>
    <button id="btn-down">↓</button>
    <button id="btn-right">→</button>
  </div>
  <div id="message"></div>
  
  <script>
    // Ustawienia gry
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const cellSize = 20;
    const canvasWidth = canvas.width;
    const canvasHeight = canvas.height;
    const cellsX = canvasWidth / cellSize;
    const cellsY = canvasHeight / cellSize;

    let snake = [{ x: Math.floor(cellsX/2), y: Math.floor(cellsY/2) }];
    let direction = "RIGHT"; // Domyślnie wąż idzie w prawo
    let food = spawnFood();
    let gameOver = false;
    let gameInterval = setInterval(update, 150);

    // Funkcja generująca jedzenie w losowym miejscu
    function spawnFood() {
      return {
        x: Math.floor(Math.random() * cellsX),
        y: Math.floor(Math.random() * cellsY)
      };
    }

    // Rysowanie elementów gry
    function draw() {
      // Czyścimy planszę
      ctx.fillStyle = "#000";
      ctx.fillRect(0, 0, canvasWidth, canvasHeight);

      // Rysujemy jedzenie
      ctx.fillStyle = "red";
      ctx.fillRect(food.x * cellSize, food.y * cellSize, cellSize, cellSize);

      // Rysujemy węża
      for (let i = 0; i < snake.length; i++) {
        ctx.fillStyle = (i === 0) ? "lime" : "green";
        ctx.fillRect(snake[i].x * cellSize, snake[i].y * cellSize, cellSize, cellSize);
      }
    }

    // Aktualizacja stanu gry
    function update() {
      if (gameOver) return;

      let head = { x: snake[0].x, y: snake[0].y };

      // Aktualizujemy pozycję głowy na podstawie kierunku
      if (direction === "RIGHT") head.x++;
      else if (direction === "LEFT") head.x--;
      else if (direction === "UP") head.y--;
      else if (direction === "DOWN") head.y++;

      // Sprawdzamy kolizję ze ścianami
      if (head.x < 0 || head.x >= cellsX || head.y < 0 || head.y >= cellsY) {
        endGame();
        return;
      }

      // Sprawdzamy kolizję z ciałem węża
      for (let i = 0; i < snake.length; i++) {
        if (head.x === snake[i].x && head.y === snake[i].y) {
          endGame();
          return;
        }
      }

      // Dodajemy nową głowę
      snake.unshift(head);

      // Jeśli zjedzono jedzenie
      if (head.x === food.x && head.y === food.y) {
        food = spawnFood();
      } else {
        // Usuwamy ogon
        snake.pop();
      }

      draw();
    }

    // Funkcja kończąca grę
    function endGame() {
      gameOver = true;
      clearInterval(gameInterval);
      document.getElementById("message").innerText = "Przegrałeś! Odśwież stronę, aby zagrać ponownie.";
    }

    // Zmiana kierunku – nie pozwala na cofanie
    function changeDirection(newDir) {
      if (newDir === "LEFT" && direction === "RIGHT") return;
      if (newDir === "RIGHT" && direction === "LEFT") return;
      if (newDir === "UP" && direction === "DOWN") return;
      if (newDir === "DOWN" && direction === "UP") return;
      direction = newDir;
    }

    // Obsługa zdarzeń klawiatury
    document.addEventListener("keydown", function(e) {
      if (e.key === "ArrowUp") changeDirection("UP");
      else if (e.key === "ArrowDown") changeDirection("DOWN");
      else if (e.key === "ArrowLeft") changeDirection("LEFT");
      else if (e.key === "ArrowRight") changeDirection("RIGHT");
    });

    // Obsługa przycisków na ekranie
    document.getElementById("btn-up").addEventListener("click", () => changeDirection("UP"));
    document.getElementById("btn-down").addEventListener("click", () => changeDirection("DOWN"));
    document.getElementById("btn-left").addEventListener("click", () => changeDirection("LEFT"));
    document.getElementById("btn-right").addEventListener("click", () => changeDirection("RIGHT"));
  </script>
</body>
</html>